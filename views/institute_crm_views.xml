<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Extend CRM Lead Form View -->
    <record id="view_institute_crm_lead_form_inherit" model="ir.ui.view">
        <field name="name">crm.lead.form.institute.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_form_view_leads"/>
        <field name="arch" type="xml">
            
            <!-- Add institute fields after the partner name field -->
            <xpath expr="//field[@name='partner_name']" position="after">
                <field name="student_name" placeholder="Enter student's full name"/>
                <field name="parent_name" placeholder="Enter parent/guardian name"/>
            </xpath>
            
            <!-- Add phone fields after the standard phone field -->
            <xpath expr="//field[@name='phone']" position="after">
                <field name="student_phone" placeholder="Student contact number" widget="phone"/>
                <field name="alternative_phone" placeholder="Alternative contact number" widget="phone"/>
            </xpath>
            
            <!-- Add address fields in a group after city/state -->
            <xpath expr="//field[@name='city']" position="after">
                <field name="district" placeholder="District"/>
            </xpath>
            
            <!-- Add academic fields in a new group in the main sheet -->
            <xpath expr="//sheet" position="inside">
                <group string="Academic Background" name="academic_info">
                    <field name="present_qualification"/>
                    <field name="school_college" placeholder="Current/Previous institution"/>
                    <field name="course_interested" placeholder="e.g., Computer Science, MBA"/>
                </group>
            </xpath>
            
            <!-- Add lead source and contact status fields -->
            <xpath expr="//field[@name='source_id']" position="after">
                <field name="lead_source_type"/>
                <field name="is_referral" invisible="1"/>
                <field name="referral_type" invisible="is_referral == False" required="is_referral == True"/>
            </xpath>
            
            <!-- Add contact status fields in a new group -->
            <xpath expr="//sheet" position="inside">
                <group string="Contact Status" name="contact_info">
                    <field name="contact_status"/>
                    <field name="show_follow_up_fields" invisible="1"/>
                    <field name="follow_up_status" invisible="show_follow_up_fields == False"/>
                    <field name="follow_up_date" invisible="show_follow_up_fields == False"/>
                    <field name="contact_remarks" placeholder="Add notes about contact attempts, conversations, interests..."/>
                </group>
            </xpath>
            
        </field>
    </record>

    <!-- Extend CRM Lead Tree View -->
    <record id="view_institute_crm_lead_tree_inherit" model="ir.ui.view">
        <field name="name">crm.lead.tree.institute.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_tree_view_leads"/>
        <field name="arch" type="xml">
            
            <!-- Add student name column -->
            <xpath expr="//field[@name='name']" position="after">
                <field name="student_name" optional="show"/>
                <field name="parent_name" optional="hide"/>
            </xpath>
            
            <!-- Add course and qualification columns -->
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="course_interested" optional="show"/>
                <field name="present_qualification" optional="hide"/>
            </xpath>
            
            <!-- Add contact status and follow-up date -->
            <xpath expr="//field[@name='activity_ids']" position="before">
                <field name="contact_status" optional="show"/>
                <field name="follow_up_date" optional="show"/>
            </xpath>
            
        </field>
    </record>

    <!-- Extend CRM Lead Kanban View -->
    <record id="view_institute_crm_lead_kanban_inherit" model="ir.ui.view">
        <field name="name">crm.lead.kanban.institute.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
        <field name="arch" type="xml">
            
            <!-- Make sure our custom fields are available in kanban -->
            <xpath expr="//kanban" position="inside">
                <field name="student_name"/>
                <field name="course_interested"/>
                <field name="contact_status"/>
                <field name="follow_up_date"/>
            </xpath>
            
            <!-- Add student name to kanban card -->
            <xpath expr="//div[hasclass('o_kanban_record_title')]" position="replace">
                <div class="o_kanban_record_title">
                    <field name="name"/>
                    <span t-if="record.student_name.raw_value" class="text-muted">
                        (<field name="student_name"/>)
                    </span>
                </div>
            </xpath>
            
            <!-- Add course info to kanban card body -->
            <xpath expr="//div[hasclass('o_kanban_record_body')]" position="inside">
                <div t-if="record.course_interested.raw_value">
                    <i class="fa fa-graduation-cap"/> <field name="course_interested"/>
                </div>
                <div t-if="record.contact_status.raw_value">
                    <strong>Status:</strong> <field name="contact_status"/>
                </div>
                <div t-if="record.follow_up_date.raw_value" class="text-muted">
                    <i class="fa fa-calendar"/> Follow-up: <field name="follow_up_date"/>
                </div>
            </xpath>
            
        </field>
    </record>

    <!-- Extend CRM Lead Search View -->
    <record id="view_institute_crm_lead_search_inherit" model="ir.ui.view">
        <field name="name">crm.lead.search.institute.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.view_crm_case_leads_filter"/>
        <field name="arch" type="xml">
            
            <!-- Add search fields -->
            <xpath expr="//field[@name='name']" position="after">
                <field name="student_name" string="Student" filter_domain="[('student_name', 'ilike', self)]"/>
                <field name="parent_name" string="Parent" filter_domain="[('parent_name', 'ilike', self)]"/>
                <field name="student_phone" string="Phone" filter_domain="[('student_phone', 'ilike', self)]"/>
                <field name="course_interested" string="Course"/>
                <field name="school_college" string="School/College"/>
            </xpath>
            
            <!-- Add filters -->
            <xpath expr="//filter[@name='assigned_to_me']" position="after">
                <separator/>
                <filter string="Connected" name="connected" domain="[('contact_status', '=', 'connected')]"/>
                <filter string="Not Connected" name="not_connected" domain="[('contact_status', '=', 'not_connected')]"/>
                <filter string="Follow-up Due" name="follow_up_due" domain="[('follow_up_date', '&lt;=', context_today().strftime('%Y-%m-%d')), ('follow_up_date', '!=', False)]"/>
                <separator/>
                <filter string="Referrals" name="referrals" domain="[('lead_source_type', '=', 'referral')]"/>
                <filter string="Meta Facebook" name="meta_facebook" domain="[('lead_source_type', '=', 'meta_facebook')]"/>
                <filter string="Meta Instagram" name="meta_instagram" domain="[('lead_source_type', '=', 'meta_instagram')]"/>
                <filter string="Google" name="google" domain="[('lead_source_type', '=', 'google')]"/>
            </xpath>
            
            <!-- Add group by options -->
            <xpath expr="//group[@name='group_by']" position="inside">
                <filter string="Contact Status" name="contact_status_group" context="{'group_by': 'contact_status'}"/>
                <filter string="Lead Source" name="source" context="{'group_by': 'lead_source_type'}"/>
                <filter string="Qualification" name="qualification" context="{'group_by': 'present_qualification'}"/>
                <filter string="Follow-up Date" name="follow_up_date_group" context="{'group_by': 'follow_up_date'}"/>
            </xpath>
            
        </field>
    </record>

</odoo>
