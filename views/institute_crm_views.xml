<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Simplified Institute CRM Form View -->
    <record id="view_institute_crm_lead_form" model="ir.ui.view">
        <field name="name">institute.crm.lead.form</field>
        <field name="model">crm.lead</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <form string="Student Lead">
                <header>
                    <field name="stage_id" widget="statusbar" options="{'clickable': '1', 'fold_field': 'fold'}"/>
                </header>
                <sheet>
                    <!-- Hidden fields for student_management module integration -->
                    <!-- These must be loaded early so buttons can reference them -->
                    <field name="student_profile_created" invisible="1"/>
                    <field name="is_won_stage" invisible="1"/>
                    <field name="student_count" invisible="1"/>
                    
                    <!-- Smart Buttons Box (for student_management module injection) -->
                    <div class="oe_button_box" name="button_box">
                        <!-- Student buttons will be injected here by student_management module -->
                    </div>
                    
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Lead Title (e.g., Inquiry for Computer Science)" required="1"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group string="Student Information">
                            <field name="student_name" placeholder="Enter student's full name"/>
                            <field name="parent_name" placeholder="Enter parent/guardian name"/>
                            <field name="student_phone" placeholder="Student contact number" widget="phone"/>
                            <field name="alternative_phone" placeholder="Alternative contact number" widget="phone"/>
                            <field name="street" string="Address" placeholder="Street address"/>
                            <field name="district"/>
                            <field name="city" placeholder="City"/>
                            <field name="country_id" invisible="1"/>
                            <field name="state_id" placeholder="State"/>
                        </group>
                        
                        <group string="Academic Background">
                            <field name="present_qualification"/>
                            <field name="school_college" placeholder="Current/Previous institution"/>
                            <field name="course_interested"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Lead Source">
                            <field name="lead_source_type"/>
                            <field name="is_referral" invisible="1"/>
                            <field name="referral_type" invisible="is_referral == False" required="is_referral == True"/>
                        </group>
                        
                        <group string="Contact Status">
                            <field name="contact_status"/>
                            <field name="show_follow_up_fields" invisible="1"/>
                            <field name="follow_up_status" invisible="show_follow_up_fields == False"/>
                            <field name="follow_up_date" invisible="show_follow_up_fields == False"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Contact Remarks">
                            <field name="contact_remarks" placeholder="Add notes about contact attempts, conversations, interests..." nolabel="1" colspan="2"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Assignment">
                            <field name="company_id" invisible="1"/>
                            <field name="user_id" string="Salesperson" domain="[('share', '=', False)]"/>
                            <field name="team_id" widget="selection"/>
                            <field name="date_deadline" string="Expected Closing Date"/>
                        </group>
                        
                        <group string="Additional Information">
                            <field name="email_from" widget="email" string="Email"/>
                            <field name="priority" widget="priority"/>
                            <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Internal Notes" name="internal_notes">
                            <field name="description" placeholder="Add internal notes..."/>
                        </page>
                        <page string="Extra Info" name="extra_info">
                            <group>
                                <group>
                                    <field name="partner_name" string="Organization Name" invisible="1"/>
                                    <field name="website" widget="url"/>
                                </group>
                                <group>
                                    <field name="referred" invisible="1"/>
                                    <field name="type" invisible="1"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Simplified Institute CRM Tree View -->
    <record id="view_institute_crm_lead_tree" model="ir.ui.view">
        <field name="name">institute.crm.lead.tree</field>
        <field name="model">crm.lead</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <tree string="Student Leads" sample="1">
                <field name="student_name" string="Student"/>
                <field name="parent_name" string="Parent"/>
                <field name="student_phone" string="Phone"/>
                <field name="course_interested" string="Course"/>
                <field name="present_qualification" string="Qualification"/>
                <field name="contact_status" string="Status"/>
                <field name="lead_source_type" string="Source"/>
                <field name="follow_up_date" string="Follow-up"/>
                <field name="user_id" widget="many2one_avatar_user"/>
                <field name="stage_id" widget="badge"/>
                <field name="activity_ids" widget="list_activity"/>
            </tree>
        </field>
    </record>

    <!-- Institute CRM Kanban View -->
    <record id="view_institute_crm_lead_kanban" model="ir.ui.view">
        <field name="name">institute.crm.lead.kanban</field>
        <field name="model">crm.lead</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <kanban default_group_by="stage_id" class="o_kanban_small_column" on_create="quick_create" sample="1">
                <field name="student_name"/>
                <field name="student_phone"/>
                <field name="course_interested"/>
                <field name="contact_status"/>
                <field name="follow_up_date"/>
                <field name="user_id"/>
                <field name="activity_ids"/>
                <field name="activity_state"/>
                <field name="color"/>
                <field name="priority"/>
                <progressbar field="activity_state" colors='{"planned": "success", "today": "warning", "overdue": "danger"}'/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_card oe_kanban_global_click">
                            <div class="o_dropdown_kanban dropdown">
                                <a class="dropdown-toggle o-no-caret btn" role="button" data-bs-toggle="dropdown" data-bs-display="static" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                                    <span class="fa fa-ellipsis-v"/>
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <t t-if="widget.editable"><a role="menuitem" type="edit" class="dropdown-item">Edit</a></t>
                                    <t t-if="widget.deletable"><a role="menuitem" type="delete" class="dropdown-item">Delete</a></t>
                                    <ul class="oe_kanban_colorpicker" data-field="color"/>
                                </div>
                            </div>
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="student_name"/>
                                        </strong>
                                    </div>
                                    <field name="priority" widget="priority"/>
                                </div>
                                <div class="o_kanban_record_body">
                                    <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                                    <div t-if="record.course_interested.raw_value">
                                        <i class="fa fa-graduation-cap"/> <field name="course_interested"/>
                                    </div>
                                    <div t-if="record.student_phone.raw_value">
                                        <i class="fa fa-phone"/> <field name="student_phone"/>
                                    </div>
                                    <div t-if="record.contact_status.raw_value">
                                        <strong>Status:</strong> <field name="contact_status"/>
                                    </div>
                                    <div t-if="record.follow_up_date.raw_value" class="text-muted">
                                        <i class="fa fa-calendar"/> Follow-up: <field name="follow_up_date"/>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <field name="activity_ids" widget="kanban_activity"/>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <field name="user_id" widget="many2one_avatar_user"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Institute CRM Search View -->
    <record id="view_institute_crm_lead_search" model="ir.ui.view">
        <field name="name">institute.crm.lead.search</field>
        <field name="model">crm.lead</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <search string="Search Student Leads">
                <field name="student_name" string="Student" filter_domain="[('student_name', 'ilike', self)]"/>
                <field name="parent_name" string="Parent" filter_domain="[('parent_name', 'ilike', self)]"/>
                <field name="student_phone" string="Phone" filter_domain="[('student_phone', 'ilike', self)]"/>
                <field name="course_interested" string="Course"/>
                <field name="school_college" string="School/College"/>
                <field name="user_id" string="Salesperson"/>
                <field name="team_id" string="Sales Team"/>
                <field name="stage_id" string="Stage"/>
                
                <separator/>
                <filter string="My Leads" name="my_leads" domain="[('user_id', '=', uid)]"/>
                <filter string="Unassigned" name="unassigned" domain="[('user_id', '=', False)]"/>
                <separator/>
                <filter string="Connected" name="connected" domain="[('contact_status', '=', 'connected')]"/>
                <filter string="Not Connected" name="not_connected" domain="[('contact_status', '=', 'not_connected')]"/>
                <filter string="Follow-up Due" name="follow_up_due" domain="[('follow_up_date', '&lt;=', context_today().strftime('%Y-%m-%d')), ('follow_up_date', '!=', False)]"/>
                <separator/>
                <filter string="Referrals" name="referrals" domain="[('lead_source_type', '=', 'referral')]"/>
                <filter string="Meta Facebook" name="meta_facebook" domain="[('lead_source_type', '=', 'meta_facebook')]"/>
                <filter string="Meta Instagram" name="meta_instagram" domain="[('lead_source_type', '=', 'meta_instagram')]"/>
                <filter string="Google" name="google" domain="[('lead_source_type', '=', 'google')]"/>
                
                <separator/>
                <filter invisible="1" string="Late Activities" name="activities_overdue"
                    domain="[('my_activity_date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"
                    help="Show all records which have next action date is before today"/>
                <filter invisible="1" string="Today Activities" name="activities_today"
                    domain="[('my_activity_date_deadline', '=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter invisible="1" string="Future Activities" name="activities_upcoming_all"
                    domain="[('my_activity_date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))]"/>
                
                <group expand="0" string="Group By">
                    <filter string="Salesperson" name="salesperson" context="{'group_by': 'user_id'}"/>
                    <filter string="Sales Team" name="team" context="{'group_by': 'team_id'}"/>
                    <filter string="Stage" name="stage" context="{'group_by': 'stage_id'}"/>
                    <filter string="Contact Status" name="contact_status_group" context="{'group_by': 'contact_status'}"/>
                    <filter string="Lead Source" name="source" context="{'group_by': 'lead_source_type'}"/>
                    <filter string="Qualification" name="qualification" context="{'group_by': 'present_qualification'}"/>
                    <filter string="Follow-up Date" name="follow_up_date_group" context="{'group_by': 'follow_up_date'}"/>
                </group>
            </search>
        </field>
    </record>

</odoo>
